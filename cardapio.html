<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio Online - Melo Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans pb-24">

    <header class="h-40 bg-orange-600 flex items-end p-6 text-white relative overflow-hidden">
        <div class="z-10">
            <h1 id="view-store-name" class="text-3xl font-black italic uppercase tracking-tighter leading-none">Carregando...</h1>
            <p id="view-store-cat" class="text-[10px] font-bold uppercase tracking-widest opacity-80 mt-1 italic"></p>
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
    </header>

    <main class="max-w-2xl mx-auto p-6 space-y-8" id="lista-categorias">
        <div class="py-20 text-center font-bold italic uppercase text-gray-400 animate-pulse">Sincronizando Cardápio...</div>
    </main>

    <script>
        const SUPABASE_URL = 'https://xhfwrbjxitcrktccdrpn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhoZndyYmp4aXRjcmt0Y2NkcnBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MjQ5NTksImV4cCI6MjA4NjIwMDk1OX0.nyGJxdNT-qiH-oqJL4KDKA-7bRtlj5UxmXy32RswPUc';
        const sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const slug = new URLSearchParams(window.location.search).get('loja');

        async function carregarCardapio() {
            const { data: profile, error: errP } = await sbClient.from('profiles').select('id, store_name, categoria_loja').eq('slug', slug).single();

            if (errP || !profile) {
                document.getElementById('lista-categorias').innerHTML = "<div class='p-10 text-center font-bold'>Loja não encontrada ou link inválido.</div>";
                return;
            }

            document.getElementById('view-store-name').innerText = profile.store_name;
            document.getElementById('view-store-cat').innerText = profile.categoria_loja || "Delivery";

            const { data: produtos } = await sbClient.from('products').select('*').eq('tenant_id', profile.id).eq('is_active', true).order('name', { ascending: true });

            renderizar(produtos);
        }

        function renderizar(produtos) {
            const container = document.getElementById('lista-categorias');
            container.innerHTML = '';
            
            if (!produtos || produtos.length === 0) {
                container.innerHTML = "<div class='text-center py-20 font-bold text-gray-300 italic uppercase'>Cardápio vazio no momento.</div>";
                return;
            }

            const categorias = [...new Set(produtos.map(p => p.categoria_produtos || 'Destaques'))];

            categorias.forEach(cat => {
                let section = `<div><h2 class='text-xs font-black uppercase italic text-orange-500 mb-4 tracking-widest'>${cat}</h2><div class='grid gap-3'>`;
                
                produtos.filter(p => p.categoria_produtos === cat).forEach(p => {
                    section += `
                        <div class='bg-white p-4 rounded-[2rem] shadow-sm flex justify-between items-center border border-gray-100'>
                            <div class='flex-1'>
                                <h4 class='font-black italic uppercase text-xs tracking-tight'>${p.name}</h4>
                                <p class='text-[10px] text-gray-400 font-bold mt-1'>${p.description || ''}</p>
                                <p class='text-orange-600 font-black italic mt-2'>R$ ${parseFloat(p.price).toFixed(2)}</p>
                            </div>
                            <button class='bg-gray-900 text-white w-10 h-10 rounded-2xl font-black text-xl active:scale-95'>+</button>
                        </div>`;
                });

                section += `</div></div>`;
                container.innerHTML += section;
            });
        }

        carregarCardapio();
    </script>
</body>
</html>
