<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio Online - Melo Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 text-gray-900">

    <header id="header-loja" class="h-40 bg-orange-600 flex items-end p-6 text-white relative overflow-hidden">
        <div class="z-10">
            <h1 id="view-store-name" class="text-3xl font-black italic uppercase tracking-tighter">Carregando...</h1>
            <p id="view-store-cat" class="text-[10px] font-bold uppercase tracking-widest opacity-80"></p>
        </div>
        <div class="absolute inset-0 bg-black/20"></div>
    </header>

    <main class="max-w-2xl mx-auto p-6 space-y-8" id="lista-categorias">
        </main>

    <script>
        const SUPABASE_URL = 'SUA_URL';
        const SUPABASE_KEY = 'SUA_KEY';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Pega o slug da URL: site.com/cardapio.html?loja=NOME-DA-LOJA
        const slug = new URLSearchParams(window.location.search).get('loja');

        async function carregarCardapio() {
            // 1. Busca a loja pelo slug na tabela PROFILES
            const { data: profile, error: errP } = await sb.from('profiles')
                .select('id, store_name, categoria_loja')
                .eq('slug', slug)
                .single();

            if (errP || !profile) {
                document.body.innerHTML = "<div class='p-10 text-center font-bold'>Loja não encontrada ou link inválido.</div>";
                return;
            }

            document.getElementById('view-store-name').innerText = profile.store_name;
            document.getElementById('view-store-cat').innerText = profile.categoria_loja;

            // 2. Busca os produtos ATIVOS vinculados a este ID (tenant_id)
            const { data: produtos, error: errPr } = await sb.from('products')
                .select('*')
                .eq('tenant_id', profile.id)
                .eq('is_active', true) // Apenas o que NÃO está pausado
                .order('categoria_produtos', { ascending: true });

            renderizar(produtos);
        }

        function renderizar(produtos) {
            const container = document.getElementById('lista-categorias');
            container.innerHTML = '';
            
            // Agrupar por categorias
            const cats = [...new Set(produtos.map(p => p.categoria_produtos || 'Diversos'))];

            cats.forEach(cat => {
                let section = `<div><h2 class='text-sm font-black uppercase italic text-orange-500 mb-4'>${cat}</h2><div class='grid gap-3'>`;
                
                produtos.filter(p => p.categoria_produtos === cat).forEach(p => {
                    section += `
                        <div class='bg-white p-4 rounded-[2rem] shadow-sm flex justify-between items-center border border-gray-50'>
                            <div class='flex-1'>
                                <h4 class='font-black italic uppercase text-xs'>${p.name}</h4>
                                <p class='text-[10px] text-gray-400 font-bold mb-2'>${p.descripition || ''}</p>
                                <span class='text-orange-600 font-black italic'>R$ ${p.price.toFixed(2)}</span>
                            </div>
                            <button class='bg-gray-900 text-white w-10 h-10 rounded-2xl font-black text-xl'>+</button>
                        </div>`;
                });

                section += `</div></div>`;
                container.innerHTML += section;
            });
        }

        carregarCardapio();
    </script>
</body>
</html>
