async function carregarProdutos() {
    const { data: produtos, error } = await sbClient
        .from('products')
        .select('*')
        .eq('tenant_id', user.id)
        .order('name', { ascending: true });

    if (error) { console.error("Erro ao carregar:", error); return; }
    
    produtosCache = produtos || [];
    const lista = document.getElementById('lista-produtos');
    lista.innerHTML = '';
    
    // Atualiza sugest√µes de categorias para o datalist
    const cats = [...new Set(produtos.map(p => p.categoria_produtos))].filter(Boolean);
    const datalist = document.getElementById('categorias-existentes');
    if(datalist) datalist.innerHTML = cats.map(c => `<option value="${c}">`).join('');

    produtos.forEach(p => {
        // L√ìGICA DA PAUSA: Baseada na sua coluna 'is_active'
        const ativo = p.is_active === true; 
        const opacity = ativo ? 'opacity-100' : 'opacity-40 grayscale';
        const btnTxt = ativo ? 'PAUSAR' : 'ATIVAR';
        const btnColor = ativo ? 'bg-orange-50 text-orange-500' : 'bg-green-50 text-green-600';
        
        lista.innerHTML += `
            <div class="bg-white p-4 rounded-[1.5rem] border border-gray-100 flex items-center justify-between shadow-sm transition-all ${opacity}">
                <div class="flex items-center gap-3 min-w-0 flex-1">
                    <img src="${p.image_url || 'https://via.placeholder.com/100'}" class="w-12 h-12 rounded-xl object-cover bg-gray-50 shrink-0">
                    <div class="truncate">
                        <h3 class="font-bold text-gray-800 text-[11px] uppercase italic tracking-tighter truncate">${p.name}</h3>
                        <p class="text-green-600 font-black text-sm italic">R$ ${parseFloat(p.price).toFixed(2)}</p>
                    </div>
                </div>
                <div class="flex gap-2 items-center ml-2">
                    <button onclick="abrirModalEdicao('${p.id}')" class="text-xs p-1">‚úèÔ∏è</button>
                    <button onclick="toggleStatus('${p.id}', ${ativo})" class="text-[9px] font-black uppercase px-3 py-1.5 rounded-lg border border-gray-100 ${btnColor} transition-all active:scale-95">
                        ${btnTxt}
                    </button>
                    <button onclick="deletarProduto('${p.id}')" class="text-xs p-1">üóëÔ∏è</button>
                </div>
            </div>`;
    });
}

// FUN√á√ÉO DE PAUSA CORRIGIDA PARA A TABELA 'products' E COLUNA 'is_active'
async function toggleStatus(id, statusAtual) {
    // Muda de true para false ou de false para true
    const novoStatus = !statusAtual;

    const { error } = await sbClient
        .from('products')
        .update({ is_active: novoStatus })
        .eq('id', id);
    
    if (error) {
        console.error("Erro ao atualizar status:", error);
        alert("N√£o foi poss√≠vel alterar o status do produto.");
    } else {
        // Recarrega a lista para mostrar a altera√ß√£o visual na hora
        carregarProdutos();
    }
}
