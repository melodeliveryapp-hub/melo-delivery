async function salvarConfigLoja() {
    const btn = document.getElementById('btn-salvar-loja');
    btn.innerHTML = "Salvando..."; 
    btn.disabled = true;

    try {
        // 1. Pega os valores (com prote√ß√£o contra campo vazio)
        const taxaMain = document.getElementById('fee-main').value;
        const taxaFar = document.getElementById('fee-far').value;

        // Verifica se √© n√∫mero v√°lido
        if (taxaMain === "" || taxaFar === "") {
            throw new Error("Por favor, preencha os valores das taxas (use 0 se for gr√°tis).");
        }

        let updateData = {
            delivery_fee_main: parseFloat(taxaMain),
            delivery_fee_far: parseFloat(taxaFar)
        };

        // 2. Uploads de Imagem (Mantido igual)
        const logoFile = document.getElementById('up-logo').files[0];
        const bannerFile = document.getElementById('up-banner').files[0];

        if (logoFile) {
            const nome = `logo_${Date.now()}`;
            const { error: errUp } = await sbClient.storage.from('product-images').upload(`${user.id}/${nome}`, logoFile);
            if (errUp) throw errUp;
            const { data } = sbClient.storage.from('product-images').getPublicUrl(`${user.id}/${nome}`);
            updateData.logo_url = data.publicUrl;
        }

        if (bannerFile) {
            const nome = `banner_${Date.now()}`;
            const { error: errUp } = await sbClient.storage.from('product-images').upload(`${user.id}/${nome}`, bannerFile);
            if (errUp) throw errUp;
            const { data } = sbClient.storage.from('product-images').getPublicUrl(`${user.id}/${nome}`);
            updateData.banner_url = data.publicUrl;
        }

        // 3. Salva no Banco (Store Info)
        console.log("Enviando dados:", updateData); // Para depura√ß√£o
        const { error } = await sbClient.from('store_info').update(updateData).eq('id', storeInfoId);
        
        if (error) throw error;

        alert("Loja atualizada com sucesso! üè™");

    } catch (e) {
        console.error(e);
        alert("Erro ao salvar: " + e.message); // Agora vai te dizer o motivo exato
    } finally {
        btn.innerHTML = "SALVAR ALTERA√á√ïES DA LOJA"; 
        btn.disabled = false;
    }
}
