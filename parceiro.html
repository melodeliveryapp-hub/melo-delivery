<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melo Delivery para Parceiros - Venda Mais!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        .gradient-text { background-clip: text; -webkit-background-clip: text; color: transparent; background-image: linear-gradient(to right, #ea580c, #c2410c); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-pop { animation: slideUp 0.5s ease-out; }
        #slider-wrapper { width: 100%; overflow: hidden; border-radius: 2.5rem; }
        input, select, textarea { color: #ffffff !important; background: rgba(255,255,255,0.05) !important; }
        ::placeholder { color: #6b7280 !important; }
        .card-plano { transition: all 0.3s ease; }
        .card-plano:hover { transform: translateY(-10px); border-color: #f97316; }
        .fase-emoji { font-size: 3rem; margin-bottom: 1rem; }
    </style>
</head>
<body class="bg-gray-950 text-white font-sans antialiased selection:bg-orange-500">

    <nav class="w-full py-6 px-6 flex justify-between items-center max-w-6xl mx-auto border-b border-white/5">
        <div class="font-black text-2xl tracking-tighter italic uppercase">MELO<span class="text-orange-500">DELIVERY</span></div>
        <div class="flex gap-4">
            <a href="login.html" class="text-[10px] font-black uppercase italic text-gray-400 hover:text-white transition-colors flex items-center">J√° sou lojista</a>
            <button onclick="abrirFormulario()" class="bg-white text-gray-900 px-6 py-2.5 rounded-full font-black italic uppercase text-[10px] shadow-lg active:scale-95 transition-all">Come√ßar Agora</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-12 md:py-20 grid grid-cols-1 md:grid-cols-2 gap-12 items-center border-b border-white/5">
        <div class="space-y-8 animate-pop">
            <div class="inline-block px-4 py-1.5 bg-orange-500/10 border border-orange-500/20 rounded-full text-orange-500 text-[10px] font-black uppercase tracking-widest italic">Expanda seu neg√≥cio local</div>
            <h1 class="text-5xl md:text-7xl font-black italic uppercase leading-[0.9] tracking-tighter">Transforme seu WhatsApp em uma <span class="gradient-text">m√°quina de vendas.</span></h1>
            <p class="text-gray-400 text-lg font-medium leading-relaxed max-w-md">Gerencie pedidos, personalize seu card√°pio e venda de forma profissional e automatizada.</p>
            <div class="flex flex-col sm:flex-row gap-4 pt-4">
                <button onclick="abrirFormulario()" class="bg-orange-600 hover:bg-orange-500 text-white px-10 py-5 rounded-[2rem] font-black italic uppercase text-xs shadow-2xl shadow-orange-900/20 transition-all">Quero ser parceiro üöÄ</button>
            </div>
        </div>

        <div id="slider-wrapper" class="relative shadow-2xl border border-white/5 bg-white/5 p-4 animate-pop">
            <div id="slider-container" class="flex transition-transform duration-1000 ease-in-out">
                <div class="w-full shrink-0 text-center p-12 bg-gradient-to-br from-gray-900 to-black rounded-[2rem]">
                    <div class="fase-emoji">üìù</div>
                    <h4 class="text-2xl font-black uppercase italic mb-2 text-orange-500">1. Cadastro R√°pido</h4>
                    <p class="text-gray-400 font-bold uppercase text-[11px] leading-relaxed">Preencha seus dados e escolha seu plano. Em poucos minutos sua loja ganha vida.</p>
                </div>
                <div class="w-full shrink-0 text-center p-12 bg-gradient-to-br from-gray-900 to-black rounded-[2rem]">
                    <div class="fase-emoji">ü•ò</div>
                    <h4 class="text-2xl font-black uppercase italic mb-2 text-orange-500">2. Monte seu Card√°pio</h4>
                    <p class="text-gray-400 font-bold uppercase text-[11px] leading-relaxed">Adicione fotos, pre√ßos e categorias. Tudo pronto para o cliente babar no seu produto.</p>
                </div>
                <div class="w-full shrink-0 text-center p-12 bg-gradient-to-br from-gray-900 to-black rounded-[2rem]">
                    <div class="fase-emoji">üí∞</div>
                    <h4 class="text-2xl font-black uppercase italic mb-2 text-orange-500">3. Venda sem Parar</h4>
                    <p class="text-gray-400 font-bold uppercase text-[11px] leading-relaxed">Receba pedidos organizados no WhatsApp e foque no que importa.</p>
                </div>
            </div>
        </div>
    </main>

    <section class="max-w-6xl mx-auto px-6 py-24">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-black italic uppercase tracking-tighter">Planos <span class="text-orange-500">Estrat√©gicos</span></h2>
            <p class="text-gray-500 text-[10px] font-black uppercase mt-2 italic tracking-widest">Escolha a velocidade do seu crescimento</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-end">
            <div class="bg-white/5 border border-white/10 p-8 rounded-[3rem] flex flex-col card-plano">
                <h3 class="text-xl font-black italic uppercase text-orange-500 mb-4">ü•â Bronze</h3>
                <div class="text-4xl font-black mb-6">R$ 10,00<span class="text-sm text-gray-500">/m√™s</span></div>
                <ul class="text-gray-400 text-[11px] font-bold space-y-4 mb-8 flex-1 uppercase italic">
                    <li class="text-white">‚úÖ 7 Dias de Teste Gr√°tis</li>
                    <li>‚úÖ Painel de Controle</li>
                    <li>‚úÖ Cadastro de at√© 10 itens</li>
                </ul>
                <button onclick="abrirFormulario()" class="w-full py-4 bg-white/10 rounded-2xl font-black italic uppercase text-[10px]">Escolher Bronze</button>
            </div>
            
            <div class="bg-orange-600 p-10 rounded-[3.5rem] flex flex-col shadow-2xl scale-105 relative card-plano">
                <div class="absolute top-6 -right-12 bg-white text-orange-600 px-12 py-1 font-black text-[8px] uppercase italic rotate-45">Popular</div>
                <h3 class="text-2xl font-black italic uppercase text-white mb-4">ü•à Prata</h3>
                <div class="text-4xl font-black mb-6">R$ 30,00<span class="text-sm text-white/50">/m√™s</span></div>
                <ul class="text-white text-[11px] font-bold space-y-4 mb-8 flex-1 uppercase italic">
                    <li class="bg-white/20 p-2 rounded-lg">‚úÖ 7 Dias de Teste Gr√°tis</li>
                    <li>‚úÖ Painel de Controle</li>
                    <li>‚úÖ Cadastro de at√© 30 itens</li>
                    <li>‚úÖ Suporte Personalizado</li>
                </ul>
                <button onclick="abrirFormulario()" class="w-full py-4 bg-white text-orange-600 rounded-2xl font-black italic uppercase text-[10px]">Escolher Prata</button>
            </div>
            
            <div class="bg-white/5 border border-white/10 p-8 rounded-[3rem] flex flex-col card-plano">
                <h3 class="text-xl font-black italic uppercase text-yellow-500 mb-4">ü•á Ouro</h3>
                <div class="text-4xl font-black mb-6">R$ 75,00<span class="text-sm text-gray-500">/m√™s</span></div>
                <ul class="text-gray-400 text-[11px] font-bold space-y-4 mb-8 flex-1 uppercase italic">
                    <li class="text-yellow-500">‚úÖ 15 Dias de Teste Gr√°tis</li>
                    <li>‚úÖ Painel de Controle</li>
                    <li>‚úÖ Produtos Ilimitados</li>
                    <li>‚úÖ Suporte Personalizado</li>
                    <li>‚úÖ Vantagens Exclusivas Ouro</li>
                </ul>
                <button onclick="abrirFormulario()" class="w-full py-4 bg-yellow-500/10 text-yellow-500 border border-yellow-500/20 rounded-2xl font-black italic uppercase text-[10px]">Escolher Ouro</button>
            </div>
        </div>
    </section>

    <div id="modal-parceiro" class="fixed inset-0 bg-black/95 backdrop-blur-xl z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-gray-900 w-full max-w-4xl rounded-[3rem] p-8 md:p-12 relative border border-white/10 shadow-2xl overflow-y-auto max-h-[90vh]">
            <button onclick="fecharFormulario()" class="absolute top-8 right-8 text-gray-500 hover:text-white">‚úï</button>
            
            <div class="text-center mb-10">
                <h2 class="text-3xl font-black italic uppercase tracking-tighter">Formul√°rio de <span class="text-orange-500 italic">Parceria</span></h2>
                <p class="text-gray-500 text-[10px] font-black uppercase italic tracking-widest mt-2">Crie sua conta para acessar o painel</p>
            </div>

            <form id="form-cadastro" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <input type="text" name="nome_negocio" id="nome_loja" required placeholder="Nome do Neg√≥cio" class="w-full p-5 rounded-2xl border border-white/10 outline-none focus:border-orange-500 font-bold">
                    <input type="text" name="documento" required placeholder="CNPJ, MEI ou CPF" class="w-full p-5 rounded-2xl border border-white/10 outline-none focus:border-orange-500 font-bold">
                    <input type="tel" name="telefone" id="telefone" required placeholder="Celular (WhatsApp)" class="w-full p-5 rounded-2xl border border-white/10 outline-none focus:border-orange-500 font-bold">
                </div>
                
                <div class="space-y-4 bg-white/5 p-4 rounded-3xl border border-white/10">
                    <p class="text-[10px] font-black uppercase text-orange-500 tracking-widest ml-2">Dados de Login</p>
                    <input type="email" name="email" id="email" required placeholder="Seu E-mail" class="w-full p-5 rounded-2xl border border-white/10 outline-none focus:border-orange-500 font-bold">
                    <input type="password" name="senha" id="senha" required minlength="6" placeholder="Crie uma Senha (m√≠n. 6 caracteres)" class="w-full p-5 rounded-2xl border border-white/10 outline-none focus:border-orange-500 font-bold">
                </div>

                <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <select name="segmento" required class="w-full p-5 rounded-2xl border border-white/10 outline-none bg-transparent font-bold">
                        <option value="" disabled selected>√Årea de Segmento</option>
                        <option value="Restaurante">Restaurante</option>
                        <option value="Pizzaria">Pizzaria</option>
                        <option value="A√ßaiteria">A√ßaiteria</option>
                        <option value="Hamb√∫rguer">Hamb√∫rguer</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <select name="plano" id="plano_escolhido" required class="w-full p-5 rounded-2xl border border-white/10 outline-none bg-transparent font-bold">
                        <option value="bronze">ü•â Plano Bronze</option>
                        <option value="prata">ü•à Plano Prata</option>
                        <option value="ouro">ü•á Plano Ouro</option>
                    </select>
                </div>

                <div class="md:col-span-2 pt-4">
                    <button type="submit" id="btn-submit" class="w-full bg-orange-600 py-6 rounded-3xl text-white font-black italic uppercase text-xs shadow-xl hover:bg-orange-500 transition-all">FINALIZAR CADASTRO E INICIAR TESTE üöÄ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xhfwrbjxitcrktccdrpn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhoZndyYmp4aXRjcmt0Y2NkcnBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MjQ5NTksImV4cCI6MjA4NjIwMDk1OX0.nyGJxdNT-qiH-oqJL4KDKA-7bRtlj5UxmXy32RswPUc';
        const sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function abrirFormulario() { document.getElementById('modal-parceiro').classList.remove('hidden'); document.body.style.overflow = 'hidden'; }
        function fecharFormulario() { document.getElementById('modal-parceiro').classList.add('hidden'); document.body.style.overflow = 'auto'; }

        let cur = 0;
        setInterval(() => {
            cur = (cur + 1) % 3;
            document.getElementById('slider-container').style.transform = `translateX(-${cur * 33.333}%)`;
        }, 5000);

        // N√öCLEO DA AUTOMA√á√ÉO MESTRA (Com nova regra de dias)
        document.getElementById('form-cadastro').onsubmit = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.innerText = "CRIANDO SUA CONTA..."; 
            btn.disabled = true;

            const formData = new FormData(this);
            const email = formData.get('email');
            const senha = formData.get('senha');
            const plano = formData.get('plano');
            
            // Regra Atualizada: 15 dias para Ouro, 7 para os restantes
            const dias = plano === 'ouro' ? 15 : 7;
            const hoje = new Date();
            const trialEnd = new Date();
            trialEnd.setDate(hoje.getDate() + dias);

            try {
                // PASSO 1: Cria o usu√°rio real de acesso (Auth)
                const { data: authData, error: authError } = await sbClient.auth.signUp({
                    email: email,
                    password: senha
                });
                
                if (authError) throw new Error("Erro ao criar conta de acesso: " + authError.message);
                
                const userId = authData.user.id; 

                // PASSO 2: Cria o perfil da Loja atrelado ao ID do usu√°rio
                const dadosLoja = {
                    id: userId, 
                    store_name: formData.get('nome_negocio'),
                    whatsapp_number: formData.get('telefone'),
                    plan_type: plano,
                    plan_status: true,
                    trial_start: hoje.toISOString().split('T')[0],
                    trial_end: trialEnd.toISOString().split('T')[0]
                };

                const { error: profileError } = await sbClient.from('profiles').insert([dadosLoja]);
                if (profileError) throw new Error("Erro ao gravar perfil: " + profileError.message);

                // PASSO 3: A M√°gica do Zero-Touch (Inicializa a loja)
                await sbClient.from('store_info').insert([{
                    tenant_id: userId,
                    opening_time: '00:00',
                    closing_time: '23:59',
                    delivery_fee_main: 0,
                    delivery_fee_far: 0
                }]);

                // PASSO 4: Manda aviso pro seu email via Formspree
                await fetch("https://formspree.io/f/xlgwwzlv", {
                    method: "POST", body: formData, headers: { 'Accept': 'application/json' }
                });

                alert(`üéâ SUCESSO!\nSua conta foi criada. Use o email e a senha que cadastrou para entrar.`);
                window.location.href = 'login.html'; 
                
            } catch (err) {
                console.error(err);
                alert(err.message || "Erro ao cadastrar. Tente usar outro e-mail.");
                btn.disabled = false; 
                btn.innerText = "FINALIZAR CADASTRO E INICIAR TESTE üöÄ";
            }
        };
    </script>
</body>
</html>